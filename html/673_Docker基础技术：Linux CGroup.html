<html>
 <head>
  <meta charset="utf-8"/>
  <link href="https://gmpg.org/xfn/11" rel="profile"/>
  <link href="https://coolshell.cn/xmlrpc.php" rel="pingback"/>
  <link href="/favicon.png" rel="shortcut icon"/>
  <link href="https://coolshell.cn/articles/17049.html" rel="canonical">
   <meta content="All in One SEO (AIOSEO) 4.3.6.1 " name="generator"/>
   <meta content="zh_CN" property="og:locale"/>
   <meta content="酷 壳 - CoolShell" property="og:site_name"/>
   <meta content="activity" property="og:type"/>
   <meta content="Docker基础技术：Linux CGroup | 酷 壳 - CoolShell" property="og:title"/>
   <meta content="https://coolshell.cn/articles/17049.html" property="og:url"/>
   <meta content="https://coolshell.cn/wp-content/uploads/2015/04/filter.png" property="og:image"/>
   <meta content="https://coolshell.cn/wp-content/uploads/2015/04/filter.png" property="og:image:secure_url"/>
   <meta content="224" property="og:image:width"/>
   <meta content="225" property="og:image:height"/>
   <meta content="summary" name="twitter:card"/>
   <meta content="Docker基础技术：Linux CGroup | 酷 壳 - CoolShell" name="twitter:title"/>
   <meta content="https://coolshell.cn/wp-content/uploads/2015/04/filter.png" name="twitter:image"/>
   <script class="aioseo-schema" type="application/ld+json">
    {"@context":"https:\/\/schema.org","@graph":[{"@type":"Article","@id":"https:\/\/coolshell.cn\/articles\/17049.html#article","name":"Docker\u57fa\u7840\u6280\u672f\uff1aLinux CGroup | \u9177 \u58f3 - CoolShell","headline":"Docker\u57fa\u7840\u6280\u672f\uff1aLinux CGroup","author":{"@id":"https:\/\/coolshell.cn\/articles\/author\/haoel#author"},"publisher":{"@id":"https:\/\/coolshell.cn\/#organization"},"image":{"@type":"ImageObject","url":"https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter.png","@id":"https:\/\/coolshell.cn\/#articleImage","width":224,"height":225},"datePublished":"2015-04-17T01:03:57+08:00","dateModified":"2015-04-17T03:51:03+08:00","inLanguage":"zh-CN","commentCount":87,"mainEntityOfPage":{"@id":"https:\/\/coolshell.cn\/articles\/17049.html#webpage"},"isPartOf":{"@id":"https:\/\/coolshell.cn\/articles\/17049.html#webpage"},"articleSection":"Unix\/Linux, \u64cd\u4f5c\u7cfb\u7edf, \u6742\u9879\u8d44\u6e90, cgroup, Docker, Linux"},{"@type":"BreadcrumbList","@id":"https:\/\/coolshell.cn\/articles\/17049.html#breadcrumblist","itemListElement":[{"@type":"ListItem","@id":"https:\/\/coolshell.cn\/#listItem","position":1,"item":{"@type":"WebPage","@id":"https:\/\/coolshell.cn\/","name":"\u4e3b\u9801","description":"\u4eab\u53d7\u7f16\u7a0b\u548c\u6280\u672f\u6240\u5e26\u6765\u7684\u5feb\u4e50 \u2013 https:\/\/coolshell.cn","url":"https:\/\/coolshell.cn\/"}}]},{"@type":"Organization","@id":"https:\/\/coolshell.cn\/#organization","name":"\u9177\u58f3-CoolShell","url":"https:\/\/coolshell.cn\/","logo":{"@type":"ImageObject","url":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/04\/mini.logo_.png","@id":"https:\/\/coolshell.cn\/#organizationLogo","width":306,"height":306},"image":{"@id":"https:\/\/coolshell.cn\/#organizationLogo"}},{"@type":"Person","@id":"https:\/\/coolshell.cn\/articles\/author\/haoel#author","url":"https:\/\/coolshell.cn\/articles\/author\/haoel","name":"\u9648\u7693","image":{"@type":"ImageObject","@id":"https:\/\/coolshell.cn\/articles\/17049.html#authorImage","url":"https:\/\/secure.gravatar.com\/avatar\/af2fbb7372dd5826e44d87e6ceccea40?s=96&d=mm&r=g","width":96,"height":96,"caption":"\u9648\u7693"}},{"@type":"WebPage","@id":"https:\/\/coolshell.cn\/articles\/17049.html#webpage","url":"https:\/\/coolshell.cn\/articles\/17049.html","name":"Docker\u57fa\u7840\u6280\u672f\uff1aLinux CGroup | \u9177 \u58f3 - CoolShell","inLanguage":"zh-CN","isPartOf":{"@id":"https:\/\/coolshell.cn\/#website"},"breadcrumb":{"@id":"https:\/\/coolshell.cn\/articles\/17049.html#breadcrumblist"},"author":{"@id":"https:\/\/coolshell.cn\/articles\/author\/haoel#author"},"creator":{"@id":"https:\/\/coolshell.cn\/articles\/author\/haoel#author"},"datePublished":"2015-04-17T01:03:57+08:00","dateModified":"2015-04-17T03:51:03+08:00"},{"@type":"WebSite","@id":"https:\/\/coolshell.cn\/#website","url":"https:\/\/coolshell.cn\/","name":"\u9177 \u58f3 - CoolShell","description":"\u4eab\u53d7\u7f16\u7a0b\u548c\u6280\u672f\u6240\u5e26\u6765\u7684\u5feb\u4e50 - Coding Your Ambition","inLanguage":"zh-CN","publisher":{"@id":"https:\/\/coolshell.cn\/#organization"}}]}
   </script>
   <script type="text/javascript">
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
			ga('create', "UA-7486123-1", { 'cookieDomain': 'coolshell.cn' } );
			ga('send', 'pageview');
   </script>
   <script async="" src="https://www.google-analytics.com/analytics.js">
   </script>
   <script type="text/javascript">
    window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/coolshell.cn\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.2"}};
/*! This file is auto-generated */
!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){p.clearRect(0,0,i.width,i.height),p.fillText(e,0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(t,0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(p&&p.fillText)switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s("\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!s("\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!s("\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!s("\ud83e\udef1\ud83c\udffb\u200d\ud83e\udef2\ud83c\udfff","\ud83e\udef1\ud83c\udffb\u200b\ud83e\udef2\ud83c\udfff")}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(e=t.source||{}).concatemoji?c(e.concatemoji):e.wpemoji&&e.twemoji&&(c(e.twemoji),c(e.wpemoji)))}(window,document,window._wpemojiSettings);
   </script>
   <script id="jquery-core-js" src="https://coolshell.cn/wp-includes/js/jquery/jquery.min.js?ver=3.6.3" type="text/javascript">
   </script>
   <script id="jquery-migrate-js" src="https://coolshell.cn/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.0" type="text/javascript">
   </script>
   <script id="series-js" src="https://coolshell.cn/wp-content/plugins/simple-post-series/autohide.js?ver=2.4" type="text/javascript">
   </script>
   <script id="ez-toc-scroll-scriptjs-js-after" type="text/javascript">
    jQuery(document).ready(function(){document.querySelectorAll(".ez-toc-section").forEach(t=>{t.setAttribute("ez-toc-data-id","#"+decodeURI(t.getAttribute("id")))}),jQuery("a.ez-toc-link").click(function(){let t=jQuery(this).attr("href"),e=jQuery("#wpadminbar"),i=0;30>30&&(i=30),e.length&&(i+=e.height()),jQuery('[ez-toc-data-id="'+decodeURI(t)+'"]').length>0&&(i=jQuery('[ez-toc-data-id="'+decodeURI(t)+'"]').offset().top-i),jQuery("html, body").animate({scrollTop:i},500)})});
   </script>
   <!--[if lt IE 9]>
<script type='text/javascript' src='https://coolshell.cn/wp-content/themes/MyNisarg/js/html5shiv.js?ver=3.7.3' id='html5shiv-js'></script>
<![endif]-->
   <meta content="WordPress 6.2" name="generator"/>
   <script type="text/javascript">
    window._wp_rp_static_base_url = 'https://wprp.zemanta.com/static/';
	window._wp_rp_wp_ajax_url = "https://coolshell.cn/wp-admin/admin-ajax.php";
	window._wp_rp_plugin_version = '3.6.4';
	window._wp_rp_post_id = '17049';
	window._wp_rp_num_rel_posts = '6';
	window._wp_rp_thumbnails = true;
	window._wp_rp_post_title = 'Docker%E5%9F%BA%E7%A1%80%E6%8A%80%E6%9C%AF%EF%BC%9ALinux+CGroup';
	window._wp_rp_post_tags = ['docker', 'linux', 'cgroup', '%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F', '%E6%9D%82%E9%A1%B9%E8%B5%84%E6%BA%90', 'unix%2Flinux', 'mount', 'cpu', 'type', 'memori', 'group', 'ls', 'control', 'a'];
	window._wp_rp_promoted_content = true;
   </script>
  </link>
  <link href="//fonts.googleapis.com" rel="dns-prefetch"/>
  <link href="https://coolshell.cn/feed" rel="alternate" title="酷 壳 - CoolShell » Feed" type="application/rss+xml"/>
  <link href="https://coolshell.cn/comments/feed" rel="alternate" title="酷 壳 - CoolShell » 评论Feed" type="application/rss+xml"/>
  <link href="https://coolshell.cn/articles/17049.html/feed" rel="alternate" title="酷 壳 - CoolShell » Docker基础技术：Linux CGroup评论Feed" type="application/rss+xml"/>
  <style type="text/css">
   img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 0.07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
  </style>
  <link href="https://coolshell.cn/wp-content/plugins/simple-post-series/inc/icomoon/style.css?ver=2.4" id="series_font-css" media="all" rel="stylesheet" type="text/css"/>
  <link href="https://coolshell.cn/wp-content/plugins/gutenberg/build/block-library/style.css?ver=15.7.0" id="wp-block-library-css" media="all" rel="stylesheet" type="text/css"/>
  <link href="https://coolshell.cn/wp-includes/css/classic-themes.min.css?ver=6.2" id="classic-theme-styles-css" media="all" rel="stylesheet" type="text/css"/>
  <style id="global-styles-inline-css" type="text/css">
   body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}body .is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}body .is-layout-grid{display: grid;}body .is-layout-grid > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
  </style>
  <link href="https://coolshell.cn/wp-content/plugins/wp-postratings/css/postratings-css.css?ver=1.90.1" id="wp-postratings-css" media="all" rel="stylesheet" type="text/css"/>
  <link href="https://coolshell.cn/wp-content/plugins/wp-pagenavi/pagenavi-css.css?ver=2.70" id="wp-pagenavi-css" media="all" rel="stylesheet" type="text/css"/>
  <link href="https://coolshell.cn/wp-content/plugins/easy-table-of-contents/assets/css/screen.min.css?ver=2.0.48" id="ez-toc-css" media="all" rel="stylesheet" type="text/css"/>
  <style id="ez-toc-inline-css" type="text/css">
   div#ez-toc-container p.ez-toc-title {font-size: 120%;}div#ez-toc-container p.ez-toc-title {font-weight: 500;}div#ez-toc-container ul li {font-size: 95%;}div#ez-toc-container nav ul ul li ul li {font-size: %!important;}
.ez-toc-container-direction {direction: ltr;}.ez-toc-counter ul{counter-reset: item;}.ez-toc-counter nav ul li a::before {content: counters(item, ".", decimal) ". ";display: inline-block;counter-increment: item;flex-grow: 0;flex-shrink: 0;margin-right: .2em; float: left;}.ez-toc-widget-direction {direction: ltr;}.ez-toc-widget-container ul{counter-reset: item;}.ez-toc-widget-container nav ul li a::before {content: counters(item, ".", decimal) ". ";display: inline-block;counter-increment: item;flex-grow: 0;flex-shrink: 0;margin-right: .2em; float: left;}
  </style>
  <link href="https://coolshell.cn/wp-content/themes/MyNisarg/css/bootstrap.css?ver=6.2" id="bootstrap-css" media="all" rel="stylesheet" type="text/css"/>
  <link href="https://coolshell.cn/wp-content/themes/MyNisarg/style.css?ver=6.2" id="nisarg-style-css" media="all" rel="stylesheet" type="text/css"/>
  <style id="nisarg-style-inline-css" type="text/css">
   /* Color Scheme */

	/* Accent Color */

	a:active,
	a:hover,
	a:focus {
	    color: #009688;
	}

	.navbar-default .navbar-nav > li > a:hover, .navbar-default .navbar-nav > li > a:focus {
		color: #009688;
	}

	
	.navbar-default .navbar-nav > .active > a, .navbar-default .navbar-nav > .active > a:hover, .navbar-default .navbar-nav > .active > a:focus {
		color: #009688;			
	}

	@media (min-width: 768px){
		.navbar-default .navbar-nav > .active > a, .navbar-default .navbar-nav > .active > a:hover, .navbar-default .navbar-nav > .active > a:focus {
			border-top: 4px solid #009688;
		}		
	}

	.dropdown-menu > .active > a, .dropdown-menu > .active > a:hover, .dropdown-menu > .active > a:focus {	    
	    background-color: #009688;
	}


	.navbar-default .navbar-nav > .open > a, .navbar-default .navbar-nav > .open > a:hover, .navbar-default .navbar-nav > .open > a:focus {
		color: #009688;
	}

	.navbar-default .navbar-nav > li > .dropdown-menu > li > a:hover,
	.navbar-default .navbar-nav > li > .dropdown-menu > li > a:focus {
		color: #fff;
		background-color: #009688;
	}

	.navbar-default .navbar-nav .open .dropdown-menu > .active > a, .navbar-default .navbar-nav .open .dropdown-menu > .active > a:hover, .navbar-default .navbar-nav .open .dropdown-menu > .active > a:focus {
		background-color: #fff;
		color: #009688;
	}

	@media (max-width: 767px) {
		.navbar-default .navbar-nav .open .dropdown-menu > li > a:hover {
			background-color: #009688;
			color: #fff;
		}
	}

	.sticky-post{
	    background: #009688;
	    color:white;
	}
	
	.entry-title a:hover,
	.entry-title a:focus{
	    color: #009688;
	}

	.entry-header .entry-meta::after{
	    background: #009688;
	}

	.fa {
		color: #009688;
	}

	.btn-default{
		border-bottom: 1px solid #009688;
	}

	.btn-default:hover, .btn-default:focus{
	    border-bottom: 1px solid #009688;
	    background-color: #009688;
	}

	.nav-previous:hover, .nav-next:hover{
	    border: 1px solid #009688;
	    background-color: #009688;
	}

	.next-post a:hover,.prev-post a:hover{
	    color: #009688;
	}

	.posts-navigation .next-post a:hover .fa, .posts-navigation .prev-post a:hover .fa{
	    color: #009688;
	}


	#secondary .widget-title::after{
		background-color: #009688;
	    content: "";
	    position: absolute;
	    width: 75px;
	    display: block;
	    height: 4px;    
	    bottom: -15px;
	}

	#secondary .widget a:hover,
	#secondary .widget a:focus{
		color: #009688;
	}

	#secondary .widget_calendar tbody a {
	    background-color: #009688;
	    color: #fff;
	    padding: 0.2em;
	}

	#secondary .widget_calendar tbody a:hover{
	    background-color: #009688;
	    color: #fff;
	    padding: 0.2em;
	}
  </style>
  <link href="https://coolshell.cn/wp-content/themes/MyNisarg/font-awesome/css/font-awesome.min.css?ver=6.2" id="font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
  <link href="//fonts.googleapis.com/css?family=Lato:400,300italic,700|Source+Sans+Pro:400,400italic" id="nisarggooglefonts-css" media="all" rel="stylesheet" type="text/css"/>
  <link href="https://coolshell.cn/wp-content/plugins/enlighter/cache/enlighterjs.min.css?ver=0cuVQBPCj0viGB0" id="enlighterjs-css" media="all" rel="stylesheet" type="text/css"/>
  <link href="https://coolshell.cn/wp-json/" rel="https://api.w.org/"/>
  <link href="https://coolshell.cn/wp-json/wp/v2/posts/17049" rel="alternate" type="application/json"/>
  <link href="https://coolshell.cn/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
  <link href="https://coolshell.cn/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
  <link href="https://coolshell.cn/?p=17049" rel="shortlink"/>
  <link href="https://coolshell.cn/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcoolshell.cn%2Farticles%2F17049.html" rel="alternate" type="application/json+oembed"/>
  <link href="https://coolshell.cn/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcoolshell.cn%2Farticles%2F17049.html&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
  <link href="https://coolshell.cn/wp-content/plugins/wordpress-23-related-posts-plugin/static/themes/vertical-m.css?version=3.6.4" rel="stylesheet"/>
  <style type="text/css">
   .site-header { background: #1d2b2d; }
  </style>
 </head>
 <body>
  <article class="post-content post-17049 post type-post status-publish format-standard hentry category-unixlinux category-operatingsystem category-misc tag-cgroup tag-docker tag-linux" id="post-17049">
   <header class="entry-header">
    <span class="screen-reader-text">
     Docker基础技术：Linux CGroup
    </span>
    <h1 class="entry-title">
     Docker基础技术：Linux CGroup
    </h1>
    <div class="entry-meta">
     <h5 class="entry-date">
      <i class="fa fa-calendar-o">
      </i>
      <a href="https://coolshell.cn/articles/17049.html" rel="bookmark" title="09:03">
       <time class="entry-date" datetime="2015-04-17T09:03:57+08:00" pubdate="">
        2015年04月17日
       </time>
      </a>
      <span class="byline">
       <span class="sep">
       </span>
       <i class="fa fa-user">
       </i>
       <span class="author vcard">
        <a class="url fn n" href="https://coolshell.cn/articles/author/haoel" rel="author" title="View all posts by 陈皓">
         陈皓
        </a>
       </span>
      </span>
      <i class="fa fa-comments-o">
      </i>
      <span class="screen-reader-text">
       评论
      </span>
      <a class="comments-link" href="https://coolshell.cn/articles/17049.html#comments">
       87 条评论
      </a>
      <i class="fa fa-users" style="margin-left:10px;">
      </i>
      125,433 人阅读
     </h5>
    </div>
   </header>
   <div class="entry-content">
    <p>
     <script async="" crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3415450859608158">
     </script>
     <img alt="filter" class="alignright size-full wp-image-17097" decoding="async" height="225" sizes="(max-width: 224px) 100vw, 224px" src="https://coolshell.cn/wp-content/uploads/2015/04/filter.png" srcset="https://coolshell.cn/wp-content/uploads/2015/04/filter.png 224w, https://coolshell.cn/wp-content/uploads/2015/04/filter-150x150.png 150w, https://coolshell.cn/wp-content/uploads/2015/04/filter-200x200.png 200w" width="224"/>
     前面，我们介绍了
     <a href="https://coolshell.cn/articles/17010.html" target="_blank" title="Docker基础技术：Linux Namespace">
      Linux Namespace
     </a>
     ，但是Namespace解决的问题主要是环境隔离的问题，这只是虚拟化中最最基础的一步，我们还需要解决对计算机资源使用上的隔离。也就是说，虽然你通过Namespace把我Jail到一个特定的环境中去了，但是我在其中的进程使用用CPU、内存、磁盘等这些计算资源其实还是可以随心所欲的。所以，我们希望对进程进行资源利用上的限制或控制。这就是Linux CGroup出来了的原因。
    </p>
    <p>
     Linux CGroup全称Linux Control Group， 是Linux内核的一个功能，用来限制，控制与分离一个进程组群的资源（如CPU、内存、磁盘输入输出等）。这个项目最早是由Google的工程师在2006年发起（主要是Paul Menage和Rohit Seth），最早的名称为进程容器（process containers）。在2007年时，因为在Linux内核中，容器（container）这个名词太过广泛，为避免混乱，被重命名为cgroup，并且被合并到2.6.24版的内核中去。然后，其它开始了他的发展。
    </p>
    <p>
     Linux CGroupCgroup 可​​​让​​​您​​​为​​​系​​​统​​​中​​​所​​​运​​​行​​​任​​​务​​​（进​​​程​​​）的​​​用​​​户​​​定​​​义​​​组​​​群​​​分​​​配​​​资​​​源​​​ — 比​​​如​​​ CPU 时​​​间​​​、​​​系​​​统​​​内​​​存​​​、​​​网​​​络​​​带​​​宽​​​或​​​者​​​这​​​些​​​资​​​源​​​的​​​组​​​合​​​。​​​您​​​可​​​以​​​监​​​控​​​您​​​配​​​置​​​的​​​ cgroup，拒​​​绝​​​ cgroup 访​​​问​​​某​​​些​​​资​​​源​​​，甚​​​至​​​在​​​运​​​行​​​的​​​系​​​统​​​中​​​动​​​态​​​配​​​置​​​您​​​的​​​ cgroup。
    </p>
    <p>
     主要提供了如下功能：
    </p>
    <p>
     <span id="more-17049">
     </span>
    </p>
    <ul>
     <li>
      <strong>
       Resource limitation
      </strong>
      : 限制资源使用，比如内存使用上限以及文件系统的缓存限制。
     </li>
     <li>
      <strong>
       Prioritization
      </strong>
      : 优先级控制，比如：CPU利用和磁盘IO吞吐。
     </li>
     <li>
      <strong>
       Accounting
      </strong>
      : 一些审计或一些统计，主要目的是为了计费。
     </li>
     <li>
      <strong>
       Control
      </strong>
      : 挂起进程，恢复执行进程。
     </li>
    </ul>
    <p>
     使​​​用​​​ cgroup，系​​​统​​​管​​​理​​​员​​​可​​​更​​​具​​​体​​​地​​​控​​​制​​​对​​​系​​​统​​​资​​​源​​​的​​​分​​​配​​​、​​​优​​​先​​​顺​​​序​​​、​​​拒​​​绝​​​、​​​管​​​理​​​和​​​监​​​控​​​。​​​可​​​更​​​好​​​地​​​根​​​据​​​任​​​务​​​和​​​用​​​户​​​分​​​配​​​硬​​​件​​​资​​​源​​​，提​​​高​​​总​​​体​​​效​​​率​​​。
    </p>
    <p>
     在实践中，系统管理员一般会利用CGroup做下面这些事（有点像为某个虚拟机分配资源似的）：
    </p>
    <ul>
     <li>
      隔离一个进程集合（比如：nginx的所有进程），并限制他们所消费的资源，比如绑定CPU的核。
     </li>
     <li>
      为这组进程 分配其足够使用的内存
     </li>
     <li>
      为这组进程分配相应的网络带宽和磁盘存储限制
     </li>
     <li>
      限制访问某些设备（通过设置设备的白名单）
     </li>
    </ul>
    <p>
     那么CGroup是怎么干的呢？我们先来点感性认识吧。
    </p>
    <p>
     首先，Linux把CGroup这个事实现成了一个file system，你可以mount。在我的Ubuntu 14.04下，你输入以下命令你就可以看到cgroup已为你mount好了。
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell"><a class="__cf_email__" data-cfemail="452d262d202b053027302b3130" href="/cdn-cgi/l/email-protection">[email protected]</a>:~$ mount -t cgroup
cgroup on /sys/fs/cgroup/cpuset type cgroup (rw,relatime,cpuset)
cgroup on /sys/fs/cgroup/cpu type cgroup (rw,relatime,cpu)
cgroup on /sys/fs/cgroup/cpuacct type cgroup (rw,relatime,cpuacct)
cgroup on /sys/fs/cgroup/memory type cgroup (rw,relatime,memory)
cgroup on /sys/fs/cgroup/devices type cgroup (rw,relatime,devices)
cgroup on /sys/fs/cgroup/freezer type cgroup (rw,relatime,freezer)
cgroup on /sys/fs/cgroup/blkio type cgroup (rw,relatime,blkio)
cgroup on /sys/fs/cgroup/net_prio type cgroup (rw,net_prio)
cgroup on /sys/fs/cgroup/net_cls type cgroup (rw,net_cls)
cgroup on /sys/fs/cgroup/perf_event type cgroup (rw,relatime,perf_event)
cgroup on /sys/fs/cgroup/hugetlb type cgroup (rw,relatime,hugetlb)</pre>
    <p>
     或者使用lssubsys命令：
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell">$ lssubsys  -m
cpuset /sys/fs/cgroup/cpuset
cpu /sys/fs/cgroup/cpu
cpuacct /sys/fs/cgroup/cpuacct
memory /sys/fs/cgroup/memory
devices /sys/fs/cgroup/devices
freezer /sys/fs/cgroup/freezer
blkio /sys/fs/cgroup/blkio
net_cls /sys/fs/cgroup/net_cls
net_prio /sys/fs/cgroup/net_prio
perf_event /sys/fs/cgroup/perf_event
hugetlb /sys/fs/cgroup/hugetlb</pre>
    <p>
     我们可以看到，在/sys/fs下有一个cgroup的目录，这个目录下还有很多子目录，比如： cpu，cpuset，memory，blkio……这些，这些都是cgroup的子系统。分别用于干不同的事的。
    </p>
    <p>
     如果你没有看到上述的目录，你可以自己mount，下面给了一个示例：
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell">mkdir cgroup
mount -t tmpfs cgroup_root ./cgroup
mkdir cgroup/cpuset
mount -t cgroup -ocpuset cpuset ./cgroup/cpuset/
mkdir cgroup/cpu
mount -t cgroup -ocpu cpu ./cgroup/cpu/
mkdir cgroup/memory
mount -t cgroup -omemory memory ./cgroup/memory/</pre>
    <p>
     一旦mount成功，你就会看到这些目录下就有好文件了，比如，如下所示的cpu和cpuset的子系统：
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell"><a class="__cf_email__" data-cfemail="0c646f6469624c796e79627879" href="/cdn-cgi/l/email-protection">[email protected]</a>:~$ ls /sys/fs/cgroup/cpu /sys/fs/cgroup/cpuset/ 
/sys/fs/cgroup/cpu:
cgroup.clone_children  cgroup.sane_behavior  cpu.shares         release_agent
cgroup.event_control   cpu.cfs_period_us     cpu.stat           tasks
cgroup.procs           cpu.cfs_quota_us      notify_on_release  user

/sys/fs/cgroup/cpuset/:
cgroup.clone_children  cpuset.mem_hardwall             cpuset.sched_load_balance
cgroup.event_control   cpuset.memory_migrate           cpuset.sched_relax_domain_level
cgroup.procs           cpuset.memory_pressure          notify_on_release
cgroup.sane_behavior   cpuset.memory_pressure_enabled  release_agent
cpuset.cpu_exclusive   cpuset.memory_spread_page       tasks
cpuset.cpus            cpuset.memory_spread_slab       user
cpuset.mem_exclusive   cpuset.mems</pre>
    <p>
     你可以到/sys/fs/cgroup的各个子目录下去make个dir，你会发现，一旦你创建了一个子目录，这个子目录里又有很多文件了。
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell"><a class="__cf_email__" data-cfemail="18707b707d76586d7a6d766c6d" href="/cdn-cgi/l/email-protection">[email protected]</a>:/sys/fs/cgroup/cpu$ sudo mkdir haoel
[sudo] password for hchen: 
<a class="__cf_email__" data-cfemail="40282328252e003522352e3435" href="/cdn-cgi/l/email-protection">[email protected]</a>:/sys/fs/cgroup/cpu$ ls ./haoel
cgroup.clone_children  cgroup.procs       cpu.cfs_quota_us  cpu.stat           tasks
cgroup.event_control   cpu.cfs_period_us  cpu.shares        notify_on_release</pre>
    <p>
     好了，我们来看几个示例。
    </p>
    <div class="ez-toc-v2_0_48 counter-hierarchy ez-toc-counter ez-toc-grey ez-toc-container-direction" id="ez-toc-container">
     <div class="ez-toc-title-container">
      <p class="ez-toc-title">
       目录
      </p>
      <span class="ez-toc-title-toggle">
      </span>
     </div>
     <nav>
      <ul class="ez-toc-list ez-toc-list-level-1">
       <li class="ez-toc-page-1 ez-toc-heading-level-4">
        <a class="ez-toc-link ez-toc-heading-1" href="#CPU_%E9%99%90%E5%88%B6" title="CPU 限制">
         CPU 限制
        </a>
       </li>
       <li class="ez-toc-page-1 ez-toc-heading-level-4">
        <a class="ez-toc-link ez-toc-heading-2" href="#%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E9%99%90%E5%88%B6" title="内存使用限制">
         内存使用限制
        </a>
       </li>
       <li class="ez-toc-page-1 ez-toc-heading-level-4">
        <a class="ez-toc-link ez-toc-heading-3" href="#%E7%A3%81%E7%9B%98IO%E9%99%90%E5%88%B6" title="磁盘I/O限制">
         磁盘I/O限制
        </a>
       </li>
       <li class="ez-toc-page-1 ez-toc-heading-level-4">
        <a class="ez-toc-link ez-toc-heading-4" href="#CGroup%E7%9A%84%E5%AD%90%E7%B3%BB%E7%BB%9F" title="CGroup的子系统">
         CGroup的子系统
        </a>
       </li>
       <li class="ez-toc-page-1 ez-toc-heading-level-4">
        <a class="ez-toc-link ez-toc-heading-5" href="#CGroup%E7%9A%84%E6%9C%AF%E8%AF%AD" title="CGroup的术语">
         CGroup的术语
        </a>
       </li>
       <li class="ez-toc-page-1 ez-toc-heading-level-4">
        <a class="ez-toc-link ez-toc-heading-6" href="#%E4%B8%8B%E4%B8%80%E4%BB%A3%E7%9A%84CGroup" title="下一代的CGroup">
         下一代的CGroup
        </a>
       </li>
       <li class="ez-toc-page-1 ez-toc-heading-level-4">
        <a class="ez-toc-link ez-toc-heading-7" href="#%E5%8F%82%E8%80%83" title="参考">
         参考
        </a>
       </li>
      </ul>
     </nav>
    </div>
    <h4>
     <span class="ez-toc-section" id="CPU_%E9%99%90%E5%88%B6">
     </span>
     CPU 限制
     <span class="ez-toc-section-end">
     </span>
    </h4>
    <p>
     假设，我们有一个非常吃CPU的程序，叫deadloop，其源码如下：
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="c">int main(void)
{
    int i = 0;
    for(;;) i++;
    return 0;
}</pre>
    <p>
     用sudo执行起来后，毫无疑问，CPU被干到了100%（下面是top命令的输出）
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell">  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND     
 3529 root      20   0    4196    736    656 R 99.6  0.1   0:23.13 deadloop   </pre>
    <p>
     然后，我们这前不是在/sys/fs/cgroup/cpu下创建了一个haoel的group。我们先设置一下这个group的cpu利用的限制：
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell"><a class="__cf_email__" data-cfemail="f29a919a979cb28790879c8687" href="/cdn-cgi/l/email-protection">[email protected]</a>:~# cat /sys/fs/cgroup/cpu/haoel/cpu.cfs_quota_us 
-1
<a class="__cf_email__" data-cfemail="394b56564d794c5b4c574d4c" href="/cdn-cgi/l/email-protection">[email protected]</a>:~# echo 20000 &gt; /sys/fs/cgroup/cpu/haoel/cpu.cfs_quota_us</pre>
    <p>
     我们看到，这个进程的PID是3529，我们把这个进程加到这个cgroup中：
    </p>
    <p>
     <code class="EnlighterJSRAW" data-enlighter-language="shell">
      # echo 3529 &gt;&gt; /sys/fs/cgroup/cpu/haoel/tasks
     </code>
    </p>
    <p>
     然后，就会在top中看到CPU的利用立马下降成20%了。（前面我们设置的20000就是20%的意思）
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell">  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND     
 3529 root      20   0    4196    736    656 R 19.9  0.1   8:06.11 deadloop    </pre>
    <p>
     下面的代码是一个线程的示例：
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="c">#define _GNU_SOURCE         /* See feature_test_macros(7) */

#include &lt;pthread.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/syscall.h&gt;


const int NUM_THREADS = 5;

void *thread_main(void *threadid)
{
    /* 把自己加入cgroup中（syscall(SYS_gettid)为得到线程的系统tid） */
    char cmd[128];
    sprintf(cmd, "echo %ld &gt;&gt; /sys/fs/cgroup/cpu/haoel/tasks", syscall(SYS_gettid));
    system(cmd); 
    sprintf(cmd, "echo %ld &gt;&gt; /sys/fs/cgroup/cpuset/haoel/tasks", syscall(SYS_gettid));
    system(cmd);

    long tid;
    tid = (long)threadid;
    printf("Hello World! It's me, thread #%ld, pid #%ld!\n", tid, syscall(SYS_gettid));
    
    int a=0; 
    while(1) {
        a++;
    }
    pthread_exit(NULL);
}
int main (int argc, char *argv[])
{
    int num_threads;
    if (argc &gt; 1){
        num_threads = atoi(argv[1]);
    }
    if (num_threads&lt;=0 || num_threads&gt;=100){
        num_threads = NUM_THREADS;
    }

    /* 设置CPU利用率为50% */
    mkdir("/sys/fs/cgroup/cpu/haoel", 755);
    system("echo 50000 &gt; /sys/fs/cgroup/cpu/haoel/cpu.cfs_quota_us");

    mkdir("/sys/fs/cgroup/cpuset/haoel", 755);
    /* 限制CPU只能使用#2核和#3核 */
    system("echo \"2,3\" &gt; /sys/fs/cgroup/cpuset/haoel/cpuset.cpus");

    pthread_t* threads = (pthread_t*) malloc (sizeof(pthread_t)*num_threads);
    int rc;
    long t;
    for(t=0; t&lt;num_threads; t++){
        printf("In main: creating thread %ld\n", t);
        rc = pthread_create(&amp;threads[t], NULL, thread_main, (void *)t);
        if (rc){
            printf("ERROR; return code from pthread_create() is %d\n", rc);
            exit(-1);
        }
    }

    /* Last thing that main() should do */
    pthread_exit(NULL);
    free(threads);
}
</pre>
    <h4>
     <span class="ez-toc-section" id="%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E9%99%90%E5%88%B6">
     </span>
     内存使用限制
     <span class="ez-toc-section-end">
     </span>
    </h4>
    <p>
     我们再来看一个限制内存的例子（下面的代码是个死循环，其它不断的分配内存，每次512个字节，每次休息一秒）：
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;

int main(void)
{
    int size = 0;
    int chunk_size = 512;
    void *p = NULL;

    while(1) {

        if ((p = malloc(p, chunk_size)) == NULL) {
            printf("out of memory!!\n");
            break;
        }
        memset(p, 1, chunk_size);
        size += chunk_size;
        printf("[%d] - memory is allocated [%8d] bytes \n", getpid(), size);
        sleep(1);
    }
    return 0;
}</pre>
    <p>
     然后，在我们另外一边：
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell"># 创建memory cgroup
$ mkdir /sys/fs/cgroup/memory/haoel
$ echo 64k &gt; /sys/fs/cgroup/memory/haoel/memory.limit_in_bytes

# 把上面的进程的pid加入这个cgroup
$ echo [pid] &gt; /sys/fs/cgroup/memory/haoel/tasks </pre>
    <p>
     你会看到，一会上面的进程就会因为内存问题被kill掉了。
    </p>
    <h4>
     <span class="ez-toc-section" id="%E7%A3%81%E7%9B%98IO%E9%99%90%E5%88%B6">
     </span>
     磁盘I/O限制
     <span class="ez-toc-section-end">
     </span>
    </h4>
    <p>
     我们先看一下我们的硬盘IO，我们的模拟命令如下：（从/dev/sda1上读入数据，输出到/dev/null上）
    </p>
    <p>
     <code class="EnlighterJSRAW" data-enlighter-language="shell">
      sudo dd if=/dev/sda1 of=/dev/null
     </code>
    </p>
    <p>
     我们通过iotop命令我们可以看到相关的IO速度是55MB/s（虚拟机内）：
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell">  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND          
 8128 be/4 root       55.74 M/s    0.00 B/s  0.00 % 85.65 % dd if=/de~=/dev/null...</pre>
    <p>
     然后，我们先创建一个blkio（块设备IO）的cgroup
    </p>
    <p>
     <code class="EnlighterJSRAW" data-enlighter-language="shell">
      mkdir /sys/fs/cgroup/blkio/haoel
     </code>
    </p>
    <p>
     并把读IO限制到1MB/s，并把前面那个dd命令的pid放进去（注：8:0 是设备号，你可以通过ls -l /dev/sda1获得）：
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell"><a class="__cf_email__" data-cfemail="11637e7e65516473647f6564" href="/cdn-cgi/l/email-protection">[email protected]</a>:~# echo '8:0 1048576'  &gt; /sys/fs/cgroup/blkio/haoel/blkio.throttle.read_bps_device 
<a class="__cf_email__" data-cfemail="cbb9a4a4bf8bbea9bea5bfbe" href="/cdn-cgi/l/email-protection">[email protected]</a>:~# echo 8128 &gt; /sys/fs/cgroup/blkio/haoel/tasks</pre>
    <p>
     再用iotop命令，你马上就能看到读速度被限制到了1MB/s左右。
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell">  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND          
 8128 be/4 root      973.20 K/s    0.00 B/s  0.00 % 94.41 % dd if=/de~=/dev/null...</pre>
    <h4>
     <span class="ez-toc-section" id="CGroup%E7%9A%84%E5%AD%90%E7%B3%BB%E7%BB%9F">
     </span>
     CGroup的子系统
     <span class="ez-toc-section-end">
     </span>
    </h4>
    <p>
     好了，有了以上的感性认识我们来，我们来看看control group有哪些子系统：
    </p>
    <ul>
     <li>
      blkio — 这​​​个​​​子​​​系​​​统​​​为​​​块​​​设​​​备​​​设​​​定​​​输​​​入​​​/输​​​出​​​限​​​制​​​，比​​​如​​​物​​​理​​​设​​​备​​​（磁​​​盘​​​，固​​​态​​​硬​​​盘​​​，USB 等​​​等​​​）。
     </li>
     <li>
      cpu — 这​​​个​​​子​​​系​​​统​​​使​​​用​​​调​​​度​​​程​​​序​​​提​​​供​​​对​​​ CPU 的​​​ cgroup 任​​​务​​​访​​​问​​​。​​​
     </li>
     <li>
      cpuacct — 这​​​个​​​子​​​系​​​统​​​自​​​动​​​生​​​成​​​ cgroup 中​​​任​​​务​​​所​​​使​​​用​​​的​​​ CPU 报​​​告​​​。​​​
     </li>
     <li>
      cpuset — 这​​​个​​​子​​​系​​​统​​​为​​​ cgroup 中​​​的​​​任​​​务​​​分​​​配​​​独​​​立​​​ CPU（在​​​多​​​核​​​系​​​统​​​）和​​​内​​​存​​​节​​​点​​​。​​​
     </li>
     <li>
      devices — 这​​​个​​​子​​​系​​​统​​​可​​​允​​​许​​​或​​​者​​​拒​​​绝​​​ cgroup 中​​​的​​​任​​​务​​​访​​​问​​​设​​​备​​​。​​​
     </li>
     <li>
      freezer — 这​​​个​​​子​​​系​​​统​​​挂​​​起​​​或​​​者​​​恢​​​复​​​ cgroup 中​​​的​​​任​​​务​​​。​​​
     </li>
     <li>
      memory — 这​​​个​​​子​​​系​​​统​​​设​​​定​​​ cgroup 中​​​任​​​务​​​使​​​用​​​的​​​内​​​存​​​限​​​制​​​，并​​​自​​​动​​​生​​​成​​​​​内​​​存​​​资​​​源使用​​​报​​​告​​​。​​​
     </li>
     <li>
      net_cls — 这​​​个​​​子​​​系​​​统​​​使​​​用​​​等​​​级​​​识​​​别​​​符​​​（classid）标​​​记​​​网​​​络​​​数​​​据​​​包​​​，可​​​允​​​许​​​ Linux 流​​​量​​​控​​​制​​​程​​​序​​​（tc）识​​​别​​​从​​​具​​​体​​​ cgroup 中​​​生​​​成​​​的​​​数​​​据​​​包​​​。​​​
     </li>
     <li>
      net_prio — 这个子系统用来设计网络流量的优先级
     </li>
     <li>
      hugetlb — 这个子系统主要针对于HugeTLB系统进行限制，这是一个大页文件系统。
     </li>
     <p>
      ​​​
     </p>
    </ul>
    <p>
     注意，你可能在Ubuntu 14.04下看不到net_cls和net_prio这两个cgroup，你需要手动mount一下：
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell">$ sudo modprobe cls_cgroup
$ sudo mkdir /sys/fs/cgroup/net_cls
$ sudo mount -t cgroup -o net_cls none /sys/fs/cgroup/net_cls

$ sudo modprobe netprio_cgroup
$ sudo mkdir /sys/fs/cgroup/net_prio
$ sudo mount -t cgroup -o net_prio none /sys/fs/cgroup/net_prio</pre>
    <p>
     关于各个子系统的参数细节，以及更多的Linux CGroup的文档，你可以看看下面的文档：
    </p>
    <ul>
     <li>
      <a href="https://www.kernel.org/doc/Documentation/cgroups/" target="_blank">
       Linux Kernel的官方文档
      </a>
     </li>
     <li>
      <a href="https://access.redhat.com/documentation/zh-CN/Red_Hat_Enterprise_Linux/6/html-single/Resource_Management_Guide/index.html#ch-Subsystems_and_Tunable_Parameters" target="_blank">
       Redhat的官方文档
      </a>
     </li>
    </ul>
    <h4>
     <span class="ez-toc-section" id="CGroup%E7%9A%84%E6%9C%AF%E8%AF%AD">
     </span>
     CGroup的术语
     <span class="ez-toc-section-end">
     </span>
    </h4>
    <p>
     CGroup有下述术语：
    </p>
    <ul>
     <li>
      <strong>
       任务（Tasks）
      </strong>
      ：就是系统的一个进程。
     </li>
     <li>
      <strong>
       控制组（Control Group）
      </strong>
      ：一组按照某种标准划分的进程，比如官方文档中的Professor和Student，或是WWW和System之类的，其表示了某进程组。Cgroups中的资源控制都是以控制组为单位实现。一个进程可以加入到某个控制组。而资源的限制是定义在这个组上，就像上面示例中我用的haoel一样。简单点说，cgroup的呈现就是一个目录带一系列的可配置文件。
     </li>
     <li>
      <strong>
       层级（Hierarchy）
      </strong>
      ：控制组可以组织成hierarchical的形式，既一颗控制组的树（目录结构）。控制组树上的子节点继承父结点的属性。简单点说，hierarchy就是在一个或多个子系统上的cgroups目录树。
     </li>
     <li>
      <strong>
       子系统（Subsystem）
      </strong>
      ：一个子系统就是一个资源控制器，比如CPU子系统就是控制CPU时间分配的一个控制器。子系统必须附加到一个层级上才能起作用，一个子系统附加到某个层级以后，这个层级上的所有控制族群都受到这个子系统的控制。Cgroup的子系统可以有很多，也在不断增加中。
     </li>
    </ul>
    <h4>
     <span class="ez-toc-section" id="%E4%B8%8B%E4%B8%80%E4%BB%A3%E7%9A%84CGroup">
     </span>
     下一代的CGroup
     <span class="ez-toc-section-end">
     </span>
    </h4>
    <p>
     上面，我们可以看到，CGroup的一些常用方法和相关的术语。一般来说，这样的设计在一般情况下还是没什么问题的，除了操作上的用户体验不是很好，但基本满足我们的一般需求了。
    </p>
    <p>
     不过，对此，有个叫Tejun Heo的同学非常不爽，他在Linux社区里
     <a href="https://lwn.net/Articles/484254/" target="_blank">
      对cgroup吐了一把槽
     </a>
     ，还引发了内核组的各种讨论。
    </p>
    <p>
     对于Tejun Heo同学来说，cgroup设计的相当糟糕。他给出了些例子，大意就是说，如果有多种层级关系，也就是说有多种对进程的分类方式，比如，我们可以按用户来分，分成Professor和Student，同时，也有按应用类似来分的，比如WWW和NFS等。那么，当一个进程即是Professor的，也是WWW的，那么就会出现多层级正交的情况，从而出现对进程上管理的混乱。另外，一个case是，如果有一个层级A绑定cpu，而层级B绑定memory，还有一个层级C绑定cputset，而有一些进程有的需要AB，有的需要AC，有的需要ABC，管理起来就相当不易。
    </p>
    <p>
     层级操作起来比较麻烦，而且如果层级变多，更不易于操作和管理，虽然那种方式很好实现，但是在使用上有很多的复杂度。你可以想像一个图书馆的图书分类问题，你可以有各种不同的分类，分类和图书就是一种多对多的关系。
    </p>
    <p>
     所以，在Kernel 3.16后，引入了
     <a href="http://lwn.net/Articles/601840/" target="_blank">
      unified hierarchy
     </a>
     的新的设计，这个东西引入了一个叫
     <strong>
      __DEVEL__sane_behavior
     </strong>
     的特性（这个名字很明显意味目前还在开发试验阶段），它可以把所有子系统都挂载到根层级下，只有叶子节点可以存在tasks，非叶子节点只进行资源控制。
    </p>
    <p>
     我们mount一下看看：
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell">$ sudo mount -t cgroup -o __DEVEL__sane_behavior cgroup ./cgroup

$ ls ./cgroup
cgroup.controllers  cgroup.procs  cgroup.sane_behavior  cgroup.subtree_control 

$ cat ./cgroup/cgroup.controllers
cpuset cpu cpuacct memory devices freezer net_cls blkio perf_event net_prio hugetlb</pre>
    <p>
     我们可以看到有四个文件，然后，你在这里mkdir一个子目录，里面也会有这四个文件。
     <strong>
      上级的cgroup.subtree_control控制下级的cgroup.controllers。
     </strong>
    </p>
    <p>
     举个例子：假设我们有以下的目录结构，b代表blkio，m代码memory，其中，A是root，包括所有的子系统（）。
    </p>
    <pre class="EnlighterJSRAW" data-enlighter-language="shell">
# A(b,m) - B(b,m) - C (b)
#               \ - D (b) - E

# 下面的命令中， +表示enable， -表示disable

# 在B上的enable blkio
# echo +blkio &gt; A/cgroup.subtree_control

# 在C和D上enable blkio 
# echo +blkio &gt; A/B/cgroup.subtree_control

# 在B上enable memory  
# echo +memory &gt; A/cgroup.subtree_control</pre>
    <p>
     在上述的结构中，
    </p>
    <ul>
     <li>
      cgroup只有上线控制下级，无法传递到下下级。所以，C和D中没有memory的限制，E中没有blkio和memory的限制。而本层的cgroup.controllers文件是个只读的，其中的内容就看上级的subtree_control里有什么了。
     </li>
     <li>
      <strong>
       任何被配置过subtree_control的目录都不能绑定进程，根结点除外
      </strong>
      。所以，A,C,D,E可以绑上进程，但是B不行。
     </li>
    </ul>
    <p>
     我们可以看到，
     <strong>
      这种方式干净的区分开了两个事，一个是进程的分组，一个是对分组的资源控制
     </strong>
     （以前这两个事完全混在一起），在目录继承上增加了些限制，这样可以避免一些模棱两可的情况。
    </p>
    <p>
     当然，这个事还在演化中，cgroup的这些问题这个事目前由cgroup的吐槽人Tejun Heo和华为的Li Zefan同学负责解决中。总之，这是一个系统管理上的问题，而且改变会影响很多东西，但一旦方案确定，老的cgroup方式将一去不复返。
    </p>
    <h4>
     <span class="ez-toc-section" id="%E5%8F%82%E8%80%83">
     </span>
     参考
     <span class="ez-toc-section-end">
     </span>
    </h4>
    <ul>
     <li>
      <a href="https://www.kernel.org/doc/Documentation/cgroups/" target="_blank">
       Linux Kernel Cgroup Documents
      </a>
     </li>
     <li>
      <a href="https://access.redhat.com/documentation/zh-CN/Red_Hat_Enterprise_Linux/6/html-single/Resource_Management_Guide/index.html" target="_blank">
       Reahat Resource Management Guide
      </a>
     </li>
     <li>
      <a href="https://lwn.net/Articles/484251/" target="_blank">
       Fixing control groups
      </a>
     </li>
     <li>
      <a href="http://lwn.net/Articles/601840/" target="_blank">
       The unified control group hierarchy in 3.16
      </a>
     </li>
     <li>
      <a href="http://events.linuxfoundation.org/sites/events/files/slides/2014-KLF.pdf" target="_blank">
       Cgroup v2(PDF)
      </a>
     </li>
    </ul>
    <p>
     （全文完）
     <br/>
    </p>
    <div style="margin-top: 15px; font-size: 16px;color: #cc0000;">
     <p align="center">
      <strong>
       （转载本站文章请注明作者和出处
       <a href="https://coolshell.cn/">
        酷 壳 – CoolShell
       </a>
       ，请勿用于任何商业用途）
      </strong>
     </p>
    </div>
    <div class="wp_rp_wrap wp_rp_vertical_m" id="wp_rp_first">
     <div class="wp_rp_content">
      <h3 class="related_post_title">
       相关文章
      </h3>
      <ul class="related_post wp_rp">
       <li>
        <a class="wp_rp_thumbnail" href="https://coolshell.cn/articles/18654.html">
         <img alt="记一次Kubernetes/Docker网络排障" height="150" src="https://coolshell.cn/wp-content/uploads/2018/12/docker-networking-1-150x150.png" width="150"/>
        </a>
        <a class="wp_rp_title" href="https://coolshell.cn/articles/18654.html">
         记一次Kubernetes/Docker网络排障
        </a>
       </li>
       <li>
        <a class="wp_rp_thumbnail" href="https://coolshell.cn/articles/17200.html">
         <img alt="Docker基础技术：DeviceMapper" height="150" src="https://coolshell.cn/wp-content/uploads/2015/08/how_to_set_up_an_iSCSI_LUN_with_thin-150x150.jpg" width="150"/>
        </a>
        <a class="wp_rp_title" href="https://coolshell.cn/articles/17200.html">
         Docker基础技术：DeviceMapper
        </a>
       </li>
       <li>
        <a class="wp_rp_thumbnail" href="https://coolshell.cn/articles/17061.html">
         <img alt="Docker基础技术：AUFS" height="150" src="https://coolshell.cn/wp-content/uploads/2015/08/docker-filesystems-busyboxrw-150x150.png" width="150"/>
        </a>
        <a class="wp_rp_title" href="https://coolshell.cn/articles/17061.html">
         Docker基础技术：AUFS
        </a>
       </li>
       <li>
        <a class="wp_rp_thumbnail" href="https://coolshell.cn/articles/17010.html">
         <img alt="Docker基础技术：Linux Namespace（上）" height="150" src="https://coolshell.cn/wp-content/uploads/2015/04/isolation-150x150.jpg" width="150"/>
        </a>
        <a class="wp_rp_title" href="https://coolshell.cn/articles/17010.html">
         Docker基础技术：Linux Namespace（上）
        </a>
       </li>
       <li>
        <a class="wp_rp_thumbnail" href="https://coolshell.cn/articles/17029.html">
         <img alt="Docker基础技术：Linux Namespace（下）" height="150" src="https://coolshell.cn/wp-content/uploads/2015/04/jail_cell-150x150.jpg" width="150"/>
        </a>
        <a class="wp_rp_title" href="https://coolshell.cn/articles/17029.html">
         Docker基础技术：Linux Namespace（下）
        </a>
       </li>
       <li>
        <a class="wp_rp_thumbnail" href="https://coolshell.cn/articles/22320.html">
         <img alt="eBPF 介绍" height="150" src="https://coolshell.cn/wp-content/uploads/2022/12/eBPF-150x150.jpeg" width="150"/>
        </a>
        <a class="wp_rp_title" href="https://coolshell.cn/articles/22320.html">
         eBPF 介绍
        </a>
       </li>
      </ul>
     </div>
    </div>
    <div class="post-ratings" data-nonce="219ebaa8fd" id="post-ratings-17049" itemscope="" itemtype="https://schema.org/Article">
     <img alt="好烂啊" id="rating_17049_1" onclick="rate_post();" onkeypress="rate_post();" onmouseout="ratings_off(4.3, 5, 0);" onmouseover="current_rating(17049, 1, '好烂啊');" src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_on.gif" style="cursor: pointer; border: 0px;" title="好烂啊"/>
     <img alt="有点差" id="rating_17049_2" onclick="rate_post();" onkeypress="rate_post();" onmouseout="ratings_off(4.3, 5, 0);" onmouseover="current_rating(17049, 2, '有点差');" src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_on.gif" style="cursor: pointer; border: 0px;" title="有点差"/>
     <img alt="凑合看看" id="rating_17049_3" onclick="rate_post();" onkeypress="rate_post();" onmouseout="ratings_off(4.3, 5, 0);" onmouseover="current_rating(17049, 3, '凑合看看');" src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_on.gif" style="cursor: pointer; border: 0px;" title="凑合看看"/>
     <img alt="还不错" id="rating_17049_4" onclick="rate_post();" onkeypress="rate_post();" onmouseout="ratings_off(4.3, 5, 0);" onmouseover="current_rating(17049, 4, '还不错');" src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_on.gif" style="cursor: pointer; border: 0px;" title="还不错"/>
     <img alt="很精彩" id="rating_17049_5" onclick="rate_post();" onkeypress="rate_post();" onmouseout="ratings_off(4.3, 5, 0);" onmouseover="current_rating(17049, 5, '很精彩');" src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/stars_crystal/rating_half.gif" style="cursor: pointer; border: 0px;" title="很精彩"/>
     (
     <strong>
      67
     </strong>
     人打了分，平均分：
     <strong>
      4.28
     </strong>
     )
     <br/>
     <span class="post-ratings-text" id="ratings_17049_text">
     </span>
     <meta content="Docker基础技术：Linux CGroup" itemprop="name"/>
     <meta content="Docker基础技术：Linux CGroup" itemprop="headline"/>
     <meta content="前面，我们介绍了Linux Namespace，但是Namespace解决的问题主要是环境隔离的问题，这只是虚拟化中最最基础的一步，我们还需要解决对计算机资源使用上的隔离。也就是说，虽然你通过Namespace把我Jail到一个特定的环境中去了，但是我在其中的进程使用用CPU、内存、磁盘等这些计算资源其实还是可以随心所欲的。所以，我们希望对进程进行资源利用上的限制或控制。这就是Linux CGro..." itemprop="description"/>
     <meta content="2015-04-17T09:03:57+08:00" itemprop="datePublished"/>
     <meta content="2015-04-17T11:51:03+08:00" itemprop="dateModified"/>
     <meta content="https://coolshell.cn/articles/17049.html" itemprop="url"/>
     <meta content="陈皓" itemprop="author"/>
     <meta content="https://coolshell.cn/articles/17049.html" itemprop="mainEntityOfPage"/>
     <div itemprop="publisher" itemscope="" itemtype="https://schema.org/Organization" style="display: none;">
      <meta content="酷 壳 - CoolShell" itemprop="name"/>
      <meta content="https://coolshell.cn" itemprop="url"/>
      <div itemprop="logo" itemscope="" itemtype="https://schema.org/ImageObject">
       <meta content="" itemprop="url"/>
      </div>
     </div>
     <div itemprop="aggregateRating" itemscope="" itemtype="https://schema.org/AggregateRating" style="display: none;">
      <meta content="5" itemprop="bestRating"/>
      <meta content="1" itemprop="worstRating"/>
      <meta content="4.28" itemprop="ratingValue"/>
      <meta content="67" itemprop="ratingCount"/>
     </div>
    </div>
    <div class="post-ratings-loading" id="post-ratings-17049-loading">
     <img class="post-ratings-image" height="16" src="https://coolshell.cn/wp-content/plugins/wp-postratings/images/loading.gif" width="16"/>
     Loading...
    </div>
   </div>
   <footer class="entry-footer">
    <hr/>
    <div class="row">
     <div class="col-md-6 cattegories">
      <span class="cat-links">
       <i class="fa fa-folder-open">
       </i>
       <a href="https://coolshell.cn/category/operatingsystem/unixlinux" rel="category tag">
        Unix/Linux
       </a>
       ,
       <a href="https://coolshell.cn/category/operatingsystem" rel="category tag">
        操作系统
       </a>
       ,
       <a href="https://coolshell.cn/category/misc" rel="category tag">
        杂项资源
       </a>
      </span>
     </div>
     <div class="col-md-6 tags">
      <span class="tags-links">
       <i class="fa fa-tags">
       </i>
       <a href="https://coolshell.cn/tag/cgroup" rel="tag">
        cgroup
       </a>
       ,
       <a href="https://coolshell.cn/tag/docker" rel="tag">
        Docker
       </a>
       ,
       <a href="https://coolshell.cn/tag/linux" rel="tag">
        Linux
       </a>
      </span>
     </div>
    </div>
   </footer>
  </article>
 </body>
</html>